<link rel="import" href="../components/core-elements/core-elements.html">
<link rel="import" href="../components/paper-elements/paper-elements.html">
<link rel="import" href="../components/core-icons/av-icons.html">

<polymer-element name="tomato-timer">

  <template>
    <style>    
      :host {
        width: 100%;
        height: 100%;
        box-sizing: border-box;
      }
      #div {
        font-size: 60px;
        background-color: orangered;
        color: white;
      }
    </style>
    <core-card layout vertical>
        <paper-shadow z="1">
            <div id="div" vertical layout center>{{time}}</div>
            <paper-ripple fit></paper-ripple>
        </paper-shadow>
    </core-card>

  </template>

  <script>
    (function(Polymer) {

        var duration = 10;

        function padDigit(digit) {
            return ((digit < 10) ? ("0" + digit) : digit);
        } 

        function formatTime(time) {
            var minutes = parseInt(time / 60);
            var seconds = time % 60;
            return padDigit(minutes) + ':' + padDigit(seconds);
        }

        Polymer('tomato-timer', {
            time: formatTime(duration),
            ready: function() {
                var timeLeft = duration;

                this.time = formatTime(timeLeft);
                var timer = setInterval(function() {
                    timeLeft--;
                    this.time = formatTime(timeLeft);

                    if(timeLeft <= 0) {
                        clearInterval(timer);
                        var audio = new Audio('timer.mp3');
                        audio.play();
                    }
                }.bind(this), 1000);
            }
        });
    })(Polymer);

  </script>

</polymer-element>
